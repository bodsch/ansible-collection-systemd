---

systemd_unit:
  - name: "getty@tty1"
    state: present
    unit_type: service
    overwrite: true
    drop_ins:
      - name: autologin
        state: present
        Service:
          ExecStart:
            - ""
            - "{% raw %}-/sbin/agetty -o '-p -f -- \\\\u' --noclear --autologin username %I $TERM{% endraw %}"
          Type: simple

      - name: noclear
        state: absent
        Service:
          TTYVTDisallocate: false

  - name: sshd
    state: present
    unit_type: service
    overwrite: false
    unit_file:
      unit:
        Description: OpenBSD Secure Shell server
        Documentation: man:sshd(8) man:sshd_config(5)
        After:
          - network.target
          - auditd.service
        ConditionPathExists: "!/etc/ssh/sshd_not_to_be_run"
      service:
        EnvironmentFile: -/etc/default/ssh
        ExecStartPre: /usr/sbin/sshd -t
        ExecStart: /usr/sbin/sshd -D $SSHD_OPTS
        ExecReload:
          - /usr/sbin/sshd -t
          - /bin/kill -HUP $MAINPID
        KillMode: process
        Restart: on-failure
        RestartPreventExitStatus: 255
        Type: notify
        RuntimeDirectory: sshd
        RuntimeDirectoryMode: "0755"
      install:
        WantedBy: multi-user.target
        Alias: sshd.service

  - name: systemd-tmpfiles-clean
    state: present
    unit_type: timer
    unit_file:
      unit:
        Description: Daily Cleanup of Temporary Directories
        Documentation: man:tmpfiles.d(5) man:systemd-tmpfiles(8)
        ConditionPathExists: "!/etc/initrd-release"
      timer:
        OnBootSec: 15min
        OnUnitActiveSec: 1d

  # - name: chronyd
  #   state: present
  #   unit_type: service
  #   overwrite: false
  #
  #   unit:
  #     Description: "NTP client/server"
  #     Documentation: "man:chronyd(8) man:chrony.conf(5)"
  #     After:
  #       - ntpdate.service
  #       - sntp.service
  #       - ntpd.service
  #     Conflicts:
  #       - ntpd.service
  #       - systemd-timesyncd.service
  #     ConditionCapability:
  #       - CAP_SYS_TIME
  #   service:
  #     Type: forking
  #     PIDFile: /run/chrony/chronyd.pid
  #     EnvironmentFile:
  #       - "-/etc/sysconfig/chronyd"
  #     ExecStart:
  #       - "/usr/bin/chronyd $OPTIONS"
  #
  #     CapabilityBoundingSet:
  #       - CAP_AUDIT_CONTROL
  #       - CAP_AUDIT_READ
  #       - CAP_AUDIT_WRITE
  #       - CAP_BLOCK_SUSPEND
  #       - CAP_KILL
  #       - CAP_LEASE
  #       - CAP_LINUX_IMMUTABLE
  #       - CAP_MAC_ADMIN
  #       - CAP_MAC_OVERRIDE
  #       - CAP_MKNOD
  #       - CAP_SYS_ADMIN
  #       - CAP_SYS_BOOT
  #       - CAP_SYS_CHROOT
  #       - CAP_SYS_MODULE
  #       - CAP_SYS_PACCT
  #       - CAP_SYS_PTRACE
  #       - CAP_SYS_RAWIO
  #       - CAP_SYS_TTY_CONFIG
  #       - CAP_WAKE_ALARM
  #     DeviceAllow:
  #       - char-pps rw
  #       - char-ptp rw
  #       - char-rtc rw
  #     DevicePolicy: closed
  #     LockPersonality: true
  #     MemoryDenyWriteExecute: true
  #     NoNewPrivileges: true
  #     PrivateTmp: true
  #     ProtectControlGroups: true
  #     ProtectHome: true
  #     ProtectHostname: true
  #     ProtectKernelLogs: true
  #     ProtectKernelModules: true
  #     ProtectKernelTunables: true
  #     ProtectProc: invisible
  #     ProtectSystem: strict
  #     ReadWritePaths:
  #       - /run
  #       - /var/lib/chrony
  #       - -/var/log
  #     RestrictAddressFamilies:
  #       - AF_INET
  #       - AF_INET6
  #       - AF_UNIX
  #     RestrictNamespaces: true
  #     RestrictSUIDSGID: true
  #     SystemCallArchitectures: native
  #     SystemCallFilter:
  #       - "@cpu-emulation"
  #       - "@debug"
  #       - "@module"
  #       - "@mount"
  #       - "@obsolete"
  #       - "@raw-io"
  #       - "@reboot"
  #       - "@swap"
  #
  #     # Adjust restrictions for /usr/bin/sendmail (mailonchange directive)
  #     # NoNewPrivileges: false
  #     # ReadWritePaths:
  #     #   - -/var/spool
  #     # RestrictAddressFamilies:
  #     #   - AF_NETLINK
  #
  #   install:
  #     WantedBy: multi-user.target
...
